!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Aontu=e()}}((function(){var e={exports:{}};(function(t){(function(){!function(n){"object"==typeof e.exports?e.exports=n():("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).Jsonic=n()}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.Alt=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t=Object.keys,n=Object.entries,r=Object.assign,s=Object.defineProperty,o="object",i="string",l="function",a="unexpected",c="map",u="list",p="elem",f="pair",h="val",d="block_indent_",g="imp,map",m="imp,list",b="imp,null",v="open",y="close",x="null";class w extends SyntaxError{constructor(e,t,n,s,o){let i=X(e,t=R({},t),n,s,o);super(i.message),r(this,i),B(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=w;class k{constructor(e){this.match={},I("@LTP",e),I("@LTX",e),I("@LCS",e),I("@LML",e),this.end={tin:I("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const n=e.opts,r=e.cnfg;let s=e=>I(e,r),o=e=>I(e,r),i=e.F,c=s("@LTP"),u=s("@LTX"),p=s("@LCS"),f=s("@LML"),h=s("#ZZ"),g=s("#SP"),m=s("#CM"),b=s("#NR"),v=s("#ST"),y=s("#TX"),x=s("#VL"),w=s("#LN"),k={tin:h,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},j=0,A=0,S=0,C=c,T=null,N=e.src(),_=N.length,V=null!=e.log?(...t)=>e.log("lex",o(k.tin),i(k.src),j,A+":"+S,o(C),{...k},...t):void 0,O=(t,n,r,s)=>this.bad(e,V,t,k,j,n,A,S,r,r,s),P=t=>{let n=this.match[C];if(null!=n)for(let r of n){let n=r({sI:j,rI:A,cI:S,src:N,token:k,ctx:e,rule:t,bad:O});if(n)return j=n.sI?n.sI:j,A=n.rI?n.rI:A,S=n.cI?n.cI:S,C=null==n.state?C:n.state,T=null==n.state_param?T:n.state_param,V&&V(k,r),k}},E=function(s){k.len=0,k.val=void 0,k.src=void 0,k.row=A,k.use=void 0;let o={},i=0,E=[];e:for(;j<_;){let h=N[j];if(k.loc=j,k.col=S,e.xs=C,c!==C){if(u===C){if(P(s))return k;i=j;let e=N.substring(j).match(r.re.te);if(e){let t=e[0].length;i+=t,S+=t}return k.len=i-j,k.tin=y,k.val=N.substring(j,i),k.src=k.val,j=i,C=c,V&&V(k),k}if(p===C){if(P(s))return k;for(i=j;i<_&&!o[N[i]];)i++,S++;return k.val+=N.substring(j,i),k.src=k.val,k.len=k.val.length,j=i,C=c,V&&V(k),k}if(f===C){if(P(s))return k;i=j;let e=1,o=T[0],l=T[1],a=T[2],u=!!T[3],p="",f=0,h=o.length,g=l.length;if(u){let e=j-1;for(;-1<e&&r.m.SP[N[e]];)e--;0<(f=j-e-1)&&(p=t(r.m.SP)[0].repeat(f))}for(i+=o.length;i<_&&0<e;)l[0]===N[i]&&l===N.substring(i,i+g)?(i+=g,S+=g,e--):a&&o[0]===N[i]&&o===N.substring(i,i+h)?(i+=h,S+=g,e++):(n.line.row===N[i]?(A++,S=0):S++,i++);if(k.val=N.substring(j,i),k.src=k.val,k.len=k.val.length,u){k.val=k.val.substring(h,k.val.length-g),null==r.re.block_prefix&&(r.re.block_prefix=J("","^[",$(n.token["#SP"]),"]*(",n.line.sep,")")),k.val=k.val.replace(r.re.block_prefix,""),null==r.re.block_suffix&&(r.re.block_suffix=J("",n.line.sep,"[",$(n.token["#SP"]),"]*$")),k.val=k.val.replace(r.re.block_suffix,"");let e=r.re[d+p]=r.re[d+p]||J("g","^(",$(p),")|((",n.line.sep,")",$(p),")");k.val=k.val.replace(e,"$3")}return j=i,C=c,V&&V(k),k}return O("invalid_lex_state",j,N[j],{state:C})}if(P(s))return k;if(n.space.lex&&r.m.SP[h]){for(k.tin=g,S++,i=j+1;r.m.SP[N[i]];)S++,i++;return k.len=i-j,k.val=N.substring(j,i),k.src=k.val,j=i,V&&V(k),k}if(n.line.lex&&r.m.LN[h]){for(k.tin=w,i=j,S=0;r.m.LN[N[i]];)A+=n.line.row===N[i]?1:0,i++;return k.len=i-j,k.val=N.substring(j,i),k.src=k.val,j=i,V&&V(k),k}if(n.number.lex&&r.m.NR[h]){let e=N.substring(j).match(r.re.nm);if(null!=e){let t=e[0];if(i=j+t.length,null==N[i]||r.cs.vend[N[i]]){let e=+(r.re.ns?t.replace(r.re.ns,""):t);if(!isNaN(e))return k.tin=b,k.src=t,k.val=e,k.len=t.length,j+=k.len,S+=k.len,V&&V(k),k}}}if(null!=r.sm[h])return k.tin=r.sm[h],k.len=1,k.src=h,j++,S++,V&&V(k),k;if(n.block.lex&&r.cs.bs[h]){let e=N.substring(j,j+r.bmx);for(let t of r.bmk)if(e.startsWith(t)){k.tin=v,C=f,T=[t,n.block.marker[t],null,!0];continue e}}if(n.string.lex&&r.m.ST[h]){k.tin=v,S++;let e=r.cs.mln[h];E=[];let t="";for(i=j+1;i<_;i++)if(S++,h===(t=N[i])){if(!n.string.escapedouble||h!==N[i+1]){i++;break}E.push(N[i]),i++}else if("\\"===t){i++,S++;let e=r.esc[N[i]];if(null!=e)E.push(e);else if("x"===N[i]){i++;let e=parseInt(N.substring(i,i+2),16);if(isNaN(e))return j=i-2,S-=2,O("invalid_ascii",i+2,N.substring(i-2,i+2));let t=String.fromCharCode(e);E.push(t),i+=1,S+=2}else if("u"===N[i]){let e="{"===N[++i]?(i++,1):0,t=e?6:4,n=parseInt(N.substring(i,i+t),16);if(isNaN(n))return j=i-2-e,S-=2,O("invalid_unicode",i+t+1,N.substring(i-2-e,i+t+e));let r=String.fromCodePoint(n);E.push(r),i+=t-1+e,S+=t+e}else E.push(N[i])}else{let s=i,o=h.charCodeAt(0),l="\\".charCodeAt(0),a=N.charCodeAt(i);for(;i<_&&32<=a&&o!==a&&l!==a;)a=N.charCodeAt(++i),S++;if(S--,t=N[i],a<32){if(!e||!r.m.LN[t])return O("unprintable",i,"char-code="+N[i].charCodeAt(0));t===n.line.row&&(A++,S=0),E.push(N.substring(s,i+1))}else E.push(N.substring(s,i)),i--}return h!==t?O("unterminated",i,E.join("")):(k.val=E.join(""),k.src=N.substring(j,i),k.len=i-j,j=i,V&&V(k),k)}if(n.comment.lex&&r.cs.cs[h]){let e=N.substring(j,j+r.cmx);for(let t of r.cmk)if(e.startsWith(t)){if(!0!==r.cm[t]){k.tin=m,k.val="",C=f,T=[t,r.cm[t],n.comment.balance];continue e}break}k.tin=m,k.val="",C=p,o=r.m.LN}else{if(n.value.lex&&r.vs[h]){i=j;do{i++}while(null!=N[i]&&!r.cs.vend[N[i]]);let t=N.substring(j,i),n=r.vm[t];if(void 0!==(n=l===typeof n?n({sI:j,rI:A,cI:S,src:N,token:k,ctx:e,rule:s,bad:O}):n))return k.tin=x,k.val=n,k.src=t,k.len=i-j,S+=k.len,j=i,V&&V(k),k}if(!n.text.lex)return O(a,j,N[j]);C=u}}return k.tin=h,k.loc=_,k.col=S,V&&V(k),k};return E.src=N,E}bad(e,t,n,r,s,o,i,l,a,c,u){return r.why=n,r.tin=I("#BD",e.cnfg),r.loc=s,r.row=i,r.col=l,r.len=o-s,r.val=a,r.src=c,r.use=u,t&&t(I(r.tin,e.cnfg),e.F(r.src),s,i+":"+l,{...r},"error",n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new k(e);return R(t.match,this.match),t}}var j;e.exports.Lexer=k,function(e){e[e.open=0]="open",e[e.close=1]="close"}(j||(j={}));class A{constructor(e,t,n){this.id=t.uI++,this.name=e.name,this.spec=e,this.node=n,this.state=j.open,this.child=S,this.open=[],this.close=[],this.n={},this.use={},this.bo=!1!==e.bo,this.ao=!1!==e.ao,this.bc=!1!==e.bc,this.ac=!1!==e.ac}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=A;const S={name:"none",state:0};class C{constructor(){this.m=[],this.p="",this.r="",this.b=0}}e.exports.Alt=C;const T=new C,N=new C;class _{constructor(e){function t(e){let t=null!=e.c&&e.c.n;t&&(e.c=e=>{let n=!0;for(let r in t)n=n&&(null==e.n[r]||e.n[r]<=t[r]);return n}),i===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.bo=!0,this.ao=!0,this.bc=!0,this.ac=!0,this.def=e||{},this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,s="",o=t.F,i=n===j.open,l=i?e:S,c=this.def,u=i?c.open:c.close,p=i?e.bo&&c.bo:e.bc&&c.bc;if(p&&(r=p.call(this,e,t))){if(r.err)throw new w(r.err,{...r,state:i?v:y},t.t0,e,t);e.node=r.node||e.node}let f=r&&r.alt?{...N,...r.alt}:0<u.length?this.parse_alts(u,e,t):N;if(f.h&&(f=f.h(e,t,f,l)||f,s+="H"),i?e.open=f.m:e.close=f.m,f.e)throw new w(a,{...f.e.use,state:i?v:y},f.e,e,t);if(f.n)for(let a in f.n)e.n[a]=0===f.n[a]?0:(null==e.n[a]?0:e.n[a])+f.n[a],e.n[a]=0<e.n[a]?e.n[a]:0;f.u&&(e.use=Object.assign(e.use,f.u)),f.a&&(s+="A",f.a.call(this,e,t,f,l)),f.p?(t.rs.push(e),(l=e.child=new A(t.rsm[f.p],t,e.node)).parent=e,l.n={...e.n},s+="U"):f.r?((l=new A(t.rsm[f.r],t,e.node)).parent=e.parent,l.prev=e,l.n={...e.n},s+="R"):(i||(l=t.rs.pop()||S),s+="Z");let h=i?e.ao&&c.ao:e.ac&&c.ac;if(h){let n=h.call(this,e,t,f,l);if(n){if(n.err)throw t.t0.why=s,new w(n.err,{...n,state:i?v:y},t.t0,e,t);l=n.next||l}}l.why=s,t.log&&t.log("node",e.name+"~"+e.id,j[e.state],"w="+s,o(e.node));let d=0,g=f.m.length-(f.b||0);for(;d++<g;)t.next();return j.open===e.state&&(e.state=j.close),l}parse_alts(e,t,r){let s,o=T;o.m=[],o.b=0,o.p="",o.r="",o.n=void 0,o.h=void 0,o.a=void 0,o.u=void 0,o.e=void 0;let i,l=0,a=r.cnfg.t,c=e.length;for(l=0;l<c&&(i=!1,null==(s=e[l]).s||0===s.s.length?i=!0:(s.s[0]===r.t0.tin||s.s[0]===a.AA||Array.isArray(s.s[0])&&s.s[0].includes(r.t0.tin))&&(1===s.s.length?(o.m=[r.t0],i=!0):(s.s[1]===r.t1.tin||s.s[1]===a.AA||Array.isArray(s.s[1])&&s.s[1].includes(r.t1.tin))&&(o.m=[r.t0,r.t1],i=!0)),!(i=(i=i&&(!s.c||s.c(t,r,o)))&&(null==s.d||s.d===r.rs.length)));l++)s=null;return null==s&&a.ZZ!==r.t0.tin&&(o.e=r.t0),null!=s&&(o.e=s.e&&s.e(t,r,o)||void 0,o.b=s.b?s.b:o.b,o.p=s.p?s.p:o.p,o.r=s.r?s.r:o.r,o.n=s.n?s.n:o.n,o.h=s.h?s.h:o.h,o.a=s.a?s.a:o.a,o.u=s.u?s.u:o.u),r.log&&r.log("parse",t.name+"~"+t.id,j[t.state],l<e.length?"alt="+l:"no-alt",l<e.length&&s.s?"["+s.s.map(e=>a[e]).join(" ")+"]":"[]",r.tC,"p="+(o.p||""),"r="+(o.r||""),"b="+(o.b||""),o.m.map(e=>a[e.tin]).join(" "),r.F(o.m.map(e=>e.src)),"c:"+(s&&s.c?i:""),"n:"+n(t.n).join(";"),"u:"+n(t.use).join(";"),o),o}}e.exports.RuleSpec=_;class V{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.t,n=e.OB,r=e.CB,s=e.OS,o=e.CS,i=e.CL,l=e.CA,a=e.TX,d=e.NR,v=e.ST,y=e.VL,w=e.AA,k=e.ZZ,j=(e,t)=>{if(!this.options.rule.finish)return t.t0.src="END_OF_SOURCE",t.t0},A={val:{open:[{s:[n,l],p:c,n:{im:0},g:g},{s:[n],p:c,n:{im:0}},{s:[s],p:u},{s:[l],d:0,p:u,b:1,g:m},{s:[l],b:1,g:m},{s:[[a,d,v,y],i],p:c,b:2,n:{im:1},g:g},{s:[[a,d,v,y]]},{s:[r],b:1,g:b},{s:[o],b:1,g:b}],close:[{s:[l],d:0,r:p,a:e=>e.node=[e.node],g:m},{c:(e,t,n)=>(a===t.t0.tin||d===t.t0.tin||v===t.t0.tin||y===t.t0.tin)&&0===t.rs.length,r:p,a:e=>e.node=[e.node],g:m},{s:[w],b:1}],bc:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{bo:()=>({node:{}}),open:[{s:[r]},{p:f}],close:[]},list:{bo:()=>({node:[]}),open:[{s:[o]},{p:p}],close:[]},pair:{open:[{s:[[a,d,v,y],i],p:h,u:{key:!0}},{s:[r],b:1}],close:[{s:[r]},{s:[l],c:{n:{im:1}},r:f},{s:[l],b:1},{s:[[a,d,v,y],i],c:{n:{im:1}},r:f,b:2},{s:[[a,d,v,y],i],b:2},{s:[o],b:1},{s:[k],e:j,g:"end"}],bc:(e,t)=>{if(e.use.key){let n=e.open[0],r=v===n.tin?n.val:n.src,s=e.child.node,o=e.node[r];void 0===s&&i===t.v1.tin&&(s=null),e.node[r]=null==o?s:t.opts.map.merge?t.opts.map.merge(o,s):t.opts.map.extend?R(o,s):s}}},elem:{open:[{s:[n],p:c,n:{im:0}},{s:[s],p:u},{s:[l,l],b:2,g:x,a:e=>e.node.push(null)},{s:[l],g:x,a:e=>e.node.push(null)},{p:h,n:{im:1}}],close:[{s:[l,o]},{s:[l],r:p},{s:[o]},{s:[n],p:c,n:{im:0}},{s:[s],p:u},{s:[[a,d,v,y]],r:p,b:1},{s:[k],e:j,g:"end"}],bc:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=t(A).reduce((e,t)=>(e[t]=new _(A[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,n,r,s,o){let i,l={uI:1,opts:this.options,cnfg:this.config,meta:s||{},src:()=>n,root:()=>i.node,plgn:()=>r.internal().plugins,rule:S,xs:-1,v2:e.end,v1:e.end,t0:e.end,t1:e.end,tC:-2,next:d,rs:[],rsm:this.rsm,log:s&&s.log||void 0,F:E(this.config),use:{}};null!=o&&(l=R(l,o)),F(l);let c=e=>I(e,this.config),u=U(e.start(l),I("#BD",this.config),l),p=this.rsm[this.options.rule.start];if(null==p)return;let f=new A(p,l);i=f;let h=2*t(this.rsm).length*u.src.length*2*this.options.rule.maxmul;function d(){let e;l.v2=l.v1,l.v1=l.t0,l.t0=l.t1;do{e=u(f),l.tC++}while(l.cnfg.ts.IGNORE[e.tin]);return l.t1={...e},l.t0}d(),d();let g=0;for(;S!==f&&g<h;)l.log&&l.log("rule",f.name+"~"+f.id,j[f.state],l.rs.length,l.tC,"["+c(l.t0.tin)+" "+c(l.t1.tin)+"]","["+l.F(l.t0.src)+" "+l.F(l.t1.src)+"]",f,l),l.rule=f,f=f.process(l),l.log&&l.log("stack",l.rs.length,l.rs.map(e=>e.name+"~"+e.id).join("/"),f,l),g++;if(I("#ZZ",this.config)!==l.t0.tin)throw new w(a,{},l.t0,S,l);return i.node}clone(e,t){let n=new V(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=L(this.rsm[t]),e),{}),n}}e.exports.Parser=V;let O={tokenize:I,srcfmt:E,deep:R,clone:L,charset:M,longest:D,marr:function(e,t){return e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0)},trimstk:B,makelog:F,badlex:U,extract:Y,errinject:W,errdesc:X,configure:G,parserwrap:H,regexp:J,mesc:$,ender:Z};function P(e,t){let n,l,a,c,u=R({},t?{...t.options}:{tag:"-",line:{lex:!0,row:"\n",sep:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0,marker:{"'''":"'''"}},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",escapedouble:!1},text:{lex:!0},map:{extend:!0,merge:void 0},value:{lex:!0,src:{null:null,true:!0,false:!1}},plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:q,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#NR":"-0123456789+","#ST":"\"'`","#TX":!0,"#VL":!0,"#CM":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:h,finish:!0,maxmul:3},config:{modify:{}},parser:{start:void 0}},e||{}),p=function(e,t,n){if(i===typeof e){let r=p.internal();return(f.parser.start?H(f.parser):r.parser).start(r.lexer,e,p,t,n)}return e},f=e=>{if(null!=e&&o===typeof e){G(a,R(u,e));for(let e in u)p.options[e]=u[e];r(p.token,a.t)}return{...p.options}},d={token:function(e){return I(e,a,p)},options:R(f,u),parse:p,use:function(e,t){return p.options({plugin:{[e.name]:t||{}}}),p.internal().plugins.push(e),e(p)||p},rule:function(e,t){return p.internal().parser.rule(e,t)},lex:function(e,t){return p.internal().lexer.lex(e,t)},make:function(e){return P(e,p)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+f.tag,toString:function(){return this.id}};if(s(d.make,"name",{value:"make"}),t){for(let n in t)p[n]=t[n];p.parent=t;let e=t.internal();G(a=R({},e.config),u),r(p.token,a.t),c=[...e.plugins],n=e.lexer.clone(a),l=e.parser.clone(u,a)}else G(a={tI:1,t:{}},u),c=[],n=new k(a),(l=new V(u,a)).init();return r(p,d),r(p.token,a.t),s(p,"internal",{value:function(){return{lexer:n,parser:l,config:a,plugins:c}}}),p}function E(e){return(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.d.maxlen)+(e.d.maxlen<n.length?"...":"")}function I(e,t,n){let s=t.t,o=s[e];return null==o&&i===typeof e&&(s[o=t.tI++]=e,s[e]=o,s[e.substring(1)]=o,null!=n&&r(n.token,t.t)),o}function R(e,...t){let n=l===typeof e,r=null!=e&&(o===typeof e||n);for(let s of t){let t=l===typeof s,i=null!=s&&(o===typeof s||t);if(r&&i&&!t&&Array.isArray(e)===Array.isArray(s))for(let n in s)e[n]=R(e[n],s[n]);else e=void 0===s?e:t?s:i?R(Array.isArray(s)?[]:{},s):s,n=l===typeof e,r=null!=e&&(o===typeof e||n)}return e}function L(e){return R(Object.create(Object.getPrototypeOf(e)),e)}function M(...e){return e.filter(e=>!1!==e).map(e=>"object"==typeof e?t(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function D(e){return e.reduce((e,t)=>e<t.length?t.length:e,0)}function B(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function F(e){if("number"==typeof e.log){let t=!1,n=e.log;-1===n&&(n=1,t=!0),e.log=(...r)=>{if(t){let t=r.filter(e=>o!=typeof e).map(e=>l==typeof e?e.name:e).join("\t");e.opts.debug.get_console().log(t)}else e.opts.debug.get_console().dir(r,{depth:n})}}return e.log}function U(e,t,n){let r=r=>{let s=e(r);if(t===s.tin){let e={};throw null!=s.use&&(e.use=s.use),new w(s.why||a,e,s,r,n)}return s};return r.src=e.src,r}function $(e,t){return(t=new String(e)).esc=!0,t}function J(e,...t){return new RegExp(t.map(e=>e.esc?e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&"):e).join(""),e)}function Z(e,r,s){let o=t(t(r).reduce((e,t)=>(e[t[0]]=1,e),{...e})).join(""),i=n(t(r).filter(e=>1<e.length&&(!s||!s[e[0]])).reduce((e,t)=>((e[t[0]]=e[t[0]]||[]).push(t.substring(1)),e),{})).reduce((e,t)=>(e.push([t[0],t[1].map(e=>J("",$(e)).source).join("|")]),e),[]).map(e=>["|(",$(e[0]),"(?!(",e[1],")))"]).flat(1);return J("","^(([^",$(o),"]+)",...i,")+")}function W(e,t,n,r,s,o){return e.replace(/\$([\w_]+)/g,(e,i)=>JSON.stringify("code"===i?t:n[i]||(o.meta?o.meta[i]:void 0)||r[i]||s[i]||o[i]||o.opts[i]||o.cnfg[i]||"$"+i))}function Y(e,t,n){let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,o=0<n.col?n.col:0,i=null==n.src?"":n.src,l=e.substring(Math.max(0,r-333),r).split("\n"),a=e.substring(r,r+333).split("\n"),c=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(c," ")+" | \x1b[0m"+(null==e?"":e),f=l.length;return[2<f?p(l[f-3]):null,1<f?p(l[f-2]):null,p(l[f-1]+a[0])," ".repeat(c)+"   "+" ".repeat(o)+"\x1b[31m"+"^".repeat(i.length||1)+" "+t+"\x1b[0m",p(a[1]),p(a[2])].filter(e=>null!=e).join("\n")}function H(e){return{start:function(t,n,r,s,o){try{return e.start(t,n,r,s,o)}catch(i){if("SyntaxError"===i.name){let t=0,o=0,l=0,a="",c=i.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){a=c[1],t=parseInt(c[2]),o=n.substring(0,t).replace(/[^\n]/g,"").length;let e=t-1;for(;-1<e&&"\n"!==n.charAt(e);)e--;l=Math.max(n.substring(e,t).length,0)}let u=i.token||{tin:r.token.UK,loc:t,len:a.length,row:i.lineNumber||o,col:i.columnNumber||l,val:void 0,src:a};throw new w(i.code||"json",i.details||{msg:i.message},u,{},i.ctx||{uI:-1,opts:r.options,cnfg:{t:{}},token:u,meta:s,src:()=>n,root:()=>{},plgn:()=>r.internal().plugins,rule:S,xs:-1,v2:u,v1:u,t0:u,t1:u,tC:-1,rs:[],next:()=>u,rsm:{},n:{},log:s?s.log:void 0,F:E(r.internal().config),use:{}})}throw i}}}}function X(e,t,n,r,s){n={...n};let o=s.opts,i=s.meta,a=W(o.error[e]||o.error.unknown,e,t,n,r,s);l===typeof o.hint&&(o.hint={...o.hint(),...o.hint});let c=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+a,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,Y(s.src(),a,n),W((o.hint[e]||o.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,r,s),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+j[r.state]+"; token="+s.cnfg.t[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+s.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:s}};return{...Object.create(u),message:c,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}}function G(e,n){let r=t(n.token);r.forEach(t=>I(t,e));let s=r.filter(e=>null!=n.token[e].c);e.sm=s.reduce((t,r)=>(t[n.token[r].c]=e.t[r],t),{});let o=r.filter(e=>i===typeof n.token[e]);e.m=o.reduce((t,r)=>(t[r.substring(1)]=n.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),t),{});let l=r.filter(e=>null!=n.token[e].s);if(e.ts=l.reduce((t,r)=>(t[r.substring(1)]=n.token[r].s.split(",").reduce((t,n)=>(t[e.t[n]]=n,t),{}),t),{}),e.vm=n.value.src,e.vs=t(n.value.src).reduce((e,t)=>(e[t[0]]=!0,e),{}),e.cs={},e.esc=t(n.string.escape).reduce((e,t)=>(e[t]=n.string.escape[t],e),{}),e.cs.cs={},e.cmk=[],n.comment.lex){e.cm=n.comment.marker;let r=t(e.cm);r.forEach(t=>{1===t.length?e.cs.cs[t]=t.charCodeAt(0):(e.cs.cs[t[0]]=t.charCodeAt(0),e.cmk.push(t))}),e.cmx=D(r)}e.sc=t(e.sm).join(""),e.cs.dig=M(n.number.digital),e.cs.mln=M(n.string.multiline),e.cs.vend=M(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),e.cs.bs={},e.bmk=[];let a=t(n.block.marker);a.forEach(t=>{e.cs.bs[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmx=D(a);let c=null!=n.number.sep?new RegExp(n.number.sep,"g"):null;e.re={ns:c,te:Z(M(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),{...n.comment.lex?e.cm:{},...n.block.lex?n.block.marker:{}},e.sm),nm:new RegExp(["^[-+]?(0(",[n.number.hex?"x[0-9a-fA-F_]+":null,n.number.oct?"o[0-7_]+":null,n.number.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[0-9]+([0-9_]*[0-9])?)","(\\.[0-9]+([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].filter(e=>e.replace(/_/g,null==c?"":n.number.sep)).join(""))},e.d=n.debug,t(n.config.modify).forEach(t=>n.config.modify[t](e,n)),n.debug.print.config&&n.debug.get_console().dir(e,{depth:null})}function q(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=O,e.exports.make=P;let z=P();e.exports.Jsonic=z;let K=z;return delete K.options,delete K.use,delete K.rule,delete K.lex,delete K.token,z.Jsonic=z,z.JsonicError=w,z.Lexer=k,z.Parser=V,z.Rule=A,z.RuleSpec=_,z.Alt=C,z.util=O,z.make=P,e.exports.default=z,e.exports=e.exports.Jsonic,e.exports}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),e=e.exports;var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.makeMemResolver=void 0,t.makeMemResolver=function(e){return function(t,n){let r=n&&n.meta&&n.meta.multisource||{},s=n&&n.opts&&n.opts&&n.opts.plugin&&n.opts.plugin.multisource||{},o=null==r.path?s.path:r.path,i=t.startsWith("/")?t:(null==o?"":o)+"/"+t;return{path:t,full:i,base:o,src:e[i]}}};var n,r,s,o=n={};function i(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var c,u=[],p=!1,f=-1;function h(){p&&c&&(p=!1,c.length?u=c.concat(u):f=-1,u.length&&d())}function d(){if(!p){var e=a(h);p=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,p=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||p||a(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0};var b={};(function(e){(function(){"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",s=0,o=-1,i=0,l=0;l<=e.length;++l){if(l<e.length)n=e.charCodeAt(l);else{if(47===n)break;n=47}if(47===n){if(o===l-1||1===i);else if(o!==l-1&&2===i){if(r.length<2||2!==s||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var a=r.lastIndexOf("/");if(a!==r.length-1){-1===a?(r="",s=0):s=(r=r.slice(0,a)).length-1-r.lastIndexOf("/"),o=l,i=0;continue}}else if(2===r.length||1===r.length){r="",s=0,o=l,i=0;continue}t&&(r.length>0?r+="/..":r="..",s=2)}else r.length>0?r+="/"+e.slice(o+1,l):r=e.slice(o+1,l),s=l-o-1;o=l,i=0}else 46===n&&-1!==i?++i:i=-1}return r}var r={resolve:function(){for(var r,s="",o=!1,i=arguments.length-1;i>=-1&&!o;i--){var l;i>=0?l=arguments[i]:(void 0===r&&(r=e.cwd()),l=r),t(l),0!==l.length&&(s=l+"/"+s,o=47===l.charCodeAt(0))}return s=n(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&s&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var s=arguments[n];t(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var o=e.length,i=o-s,l=1;l<n.length&&47===n.charCodeAt(l);++l);for(var a=n.length-l,c=i<a?i:a,u=-1,p=0;p<=c;++p){if(p===c){if(a>c){if(47===n.charCodeAt(l+p))return n.slice(l+p+1);if(0===p)return n.slice(l+p)}else i>c&&(47===e.charCodeAt(s+p)?u=p:0===p&&(u=0));break}var f=e.charCodeAt(s+p);if(f!==n.charCodeAt(l+p))break;47===f&&(u=p)}var h="";for(p=s+u+1;p<=o;++p)p!==o&&47!==e.charCodeAt(p)||(0===h.length?h+="..":h+="/..");return h.length>0?h+n.slice(l+u):(l+=u,47===n.charCodeAt(l)&&++l,n.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,s=-1,o=!0,i=e.length-1;i>=1;--i)if(47===(n=e.charCodeAt(i))){if(!o){s=i;break}}else o=!1;return-1===s?r?"/":".":r&&1===s?"//":e.slice(0,s)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,s=0,o=-1,i=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var l=n.length-1,a=-1;for(r=e.length-1;r>=0;--r){var c=e.charCodeAt(r);if(47===c){if(!i){s=r+1;break}}else-1===a&&(i=!1,a=r+1),l>=0&&(c===n.charCodeAt(l)?-1==--l&&(o=r):(l=-1,o=a))}return s===o?o=a:-1===o&&(o=e.length),e.slice(s,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!i){s=r+1;break}}else-1===o&&(i=!1,o=r+1);return-1===o?"":e.slice(s,o)},extname:function(e){t(e);for(var n=-1,r=0,s=-1,o=!0,i=0,l=e.length-1;l>=0;--l){var a=e.charCodeAt(l);if(47!==a)-1===s&&(o=!1,s=l+1),46===a?-1===n?n=l:1!==i&&(i=1):-1!==n&&(i=-1);else if(!o){r=l+1;break}}return-1===n||-1===s||0===i||1===i&&n===s-1&&n===r+1?"":e.slice(n,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+"/"+r:r}(0,e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,s=e.charCodeAt(0),o=47===s;o?(n.root="/",r=1):r=0;for(var i=-1,l=0,a=-1,c=!0,u=e.length-1,p=0;u>=r;--u)if(47!==(s=e.charCodeAt(u)))-1===a&&(c=!1,a=u+1),46===s?-1===i?i=u:1!==p&&(p=1):-1!==i&&(p=-1);else if(!c){l=u+1;break}return-1===i||-1===a||0===p||1===p&&i===a-1&&i===l+1?-1!==a&&(n.base=n.name=0===l&&o?e.slice(1,a):e.slice(l,a)):(0===l&&o?(n.name=e.slice(1,i),n.base=e.slice(1,a)):(n.name=e.slice(l,i),n.base=e.slice(l,a)),n.ext=e.slice(i,a)),l>0?n.dir=e.slice(0,l-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,b=r}).call(this)}).call(this,n);var v={},y=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0}),v.makeFileResolver=void 0;const x=y({}),w=y(b);v.makeFileResolver=function(){return function(e,t){let n=t&&t.meta&&t.meta.multisource||{},r=t&&t.opts&&t.opts&&t.opts.plugin&&t.opts.plugin.multisource||{},s=null==n.path?null==r.path?e:r.path:n.path,o=s;x.default.statSync(s).isFile()&&(o=w.default.parse(s).dir);let i=w.default.isAbsolute(e)||null==o?e:w.default.resolve(o,e);return{path:e,full:i,base:o,src:x.default.readFileSync(i).toString()}}};var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.MultiSource=void 0,Object.defineProperty(k,"makeMemResolver",{enumerable:!0,get:function(){return t.makeMemResolver}}),Object.defineProperty(k,"makeFileResolver",{enumerable:!0,get:function(){return v.makeFileResolver}});let j={markchar:"@"};const A=Symbol("TOP");k.MultiSource=function(t){let n=e.util.deep({},j,t.options.plugin.multisource),r=n.markchar,s=n.resolver,o="#T<"+r+">";t.options({token:{[o]:{c:r}},error:{multifile_unsupported_file:"unsupported file: $path"},hint:{multifile_unsupported_file:"This file type is not supported and cannot be parsed: $path."}});let i=t.token.ST,l=t.token(o);t.rule("val",e=>{e.def.open.push({s:[l,i]});let n=e.def.bc;return e.def.bc=function(e,r){if(e.open[0]&&l===e.open[0].tin){let n=void 0,o=e.open[1].val,i=s(o,r);if(null!=i.src){let e=r.meta.multisource||{},s={...r.meta,multisource:{...e,path:i.full}};if(n=t(i.src,s),e.deps){let t=e.deps,n=e.path||A;null!=n&&((t[n]=t[n]||{})[i.full]={tar:n,src:i.full,wen:Date.now()})}}e.open[0].val=n}return n(...arguments)},e})};var S={};Object.defineProperty(S,"__esModule",{value:!0}),S.PrefVal=S.RefVal=S.DisjunctVal=S.ConjunctVal=S.MapVal=S.IntegerVal=S.BooleanVal=S.StringVal=S.NumberVal=S.ScalarTypeVal=S.Nil=S.TOP=S.Val=S.Integer=S.DONE=void 0;S.DONE=-1;let C=1e9;const T={id:"V0",top:!0,peg:void 0,done:-1,path:[],row:-1,col:-1,url:"",unify(e,t){return e instanceof M||e instanceof L||e instanceof D?e.unify(this,t):e},get canon(){return"top"},same:e=>T===e,gen:e=>{}};S.TOP=T;const N=(e,t,n)=>t===T?e:e===T?t:e.constructor===t.constructor?e.peg===t.peg?e:V.make(n,"no-unify-val<"+e.canon+"&"+t.canon+">",e,t):t instanceof V?t:e instanceof V?e:t instanceof M||t instanceof L||t instanceof D?t.unify(e,n):V.make(n,"no-unify<"+e.canon+"&"+t.canon+">",e,t);class _{constructor(e,t){this.id="V"+C++,this.done=0,this.row=-1,this.col=-1,this.url="",this.peg=e,this.path=t||[]}same(e){return this===e}}S.Val=_;class V extends _{constructor(e,t){super(null,e),this.nil=!0,this.why=t,this.done=-1}unify(e,t){return this}get canon(){return"nil"}gen(e){e.push("nil")}}S.Nil=V,V.make=(e,t,n,r)=>{let s=e?e.path:[],o=new V(s,t),i=null==r?n:null!=n&&null!=r?n.row===r.row?n.col<=r.col?n:r:n.row<=r.row?n:r:null;return i&&(o.row=i.row,o.col=i.col),o};class O{}S.Integer=O;class P extends _{constructor(e){super(e),this.done=-1}unify(e,t){if(e instanceof E)return e.type===this.peg||Number===this.peg&&O===e.type?e:V.make(t,"no-scalar-unify",this,e);if(e instanceof P){if(Number===this.peg&&O===e.peg)return e;if(Number===e.peg&&O===this.peg)return this}return N(this,e,t)}get canon(){return this.peg.name.toLowerCase()}same(e){return e instanceof P?this.peg===e.peg:super.same(e)}gen(e){e.push("ScalarTypeVal<"+this.canon+">")}}S.ScalarTypeVal=P;class E extends _{constructor(e,t){super(e),this.type=t,this.done=-1}unify(e,t){return e instanceof P?e.unify(this,t):N(this,e,t)}get canon(){return this.peg.toString()}same(e){return e instanceof E?e.peg===this.peg:super.same(e)}gen(e){return this.peg}}S.NumberVal=class extends E{constructor(e){super(e,Number)}unify(e,t){return e instanceof E&&e.type===O?e:super.unify(e,t)}},S.IntegerVal=class extends E{constructor(e){if(!Number.isInteger(e))throw new Error("not-integer");super(e,O)}unify(e,t){return e instanceof P&&e.peg===Number||e instanceof E&&e.type===Number&&this.peg===e.peg?this:super.unify(e,t)}},S.StringVal=class extends E{constructor(e){super(e,String)}unify(e,t){return super.unify(e,t)}get canon(){return JSON.stringify(this.peg)}};class I extends E{constructor(e){super(e,Boolean)}unify(e,t){return super.unify(e,t)}}S.BooleanVal=I,I.TRUE=new I(!0),I.FALSE=new I(!1);class R extends _{constructor(e){super(e),this.spread={cj:void 0,dj:void 0};let t=this.peg[R.SPREAD];delete this.peg[R.SPREAD],t&&("&"===t.o?this.spread.cj=new L(Array.isArray(t.v)?t.v:[t.v]):"|"===t.o&&(this.spread.dj=new M(Array.isArray(t.v)?t.v:[t.v])))}unify(e,t){let n=!0,r=new R({});r.spread.cj=this.spread.cj,e instanceof R&&(r.spread.cj=null==r.spread.cj?e.spread.cj:null==e.spread.cj?r.spread.cj:r.spread.cj=new L([r.spread.cj,e.spread.cj])),r.done=this.done+1,this.spread.cj&&(r.spread.cj=-1!==this.spread.cj.done?this.spread.cj.unify(T,t):this.spread.cj);let s=r.spread.cj||T;for(let o in this.peg){let e=r.peg[o]=this.peg[o].unify(s,t.descend(o));n=n&&-1===r.peg[o].done,e instanceof V&&t.err.push(e)}if(e instanceof R){let o=e.unify(T,t);for(let e in o.peg){let i=o.peg[e],l=r.peg[e],a=r.peg[e]=void 0===l?i:l instanceof V?l:i instanceof V?i:l.unify(i,t.descend(e));this.spread.cj&&(r.peg[e]=r.peg[e].unify(s,t)),n=n&&-1===a.done,a instanceof V&&t.err.push(a)}return r.done=n?-1:r.done,r}return r.done=n?-1:r.done,N(r,e,t)}get canon(){let e=Object.keys(this.peg);return"{"+(this.spread.cj?"&="+this.spread.cj.canon+(0<e.length?",":""):"")+e.map(e=>[JSON.stringify(e)+":"+this.peg[e].canon]).join(",")+"}"}gen(e){let t={};for(let n in this.peg)t[n]=this.peg[n].gen(e);return t}}S.MapVal=R,R.SPREAD=Symbol("spread");class L extends _{constructor(e){super(e)}append(e){return this.peg.push(e),this}unify(e,t){let n=!0,r=[];for(let l=0;l<this.peg.length;l++)if(r[l]=this.peg[l].unify(e,t),n=n&&-1===r[l].done,r[l]instanceof V)return V.make(t,"&peer["+r[l].canon+","+e.canon+"]",this.peg[l],e);let s,o=0<r.length?[r[0]]:[],i=0;for(let l=1;l<r.length;l++)if(o[i]instanceof L)o.splice(i,0,...o[i].peg),i+=o[i].peg.length,n=!1;else if(o[i]=null==o[i]?r[l]:o[i].unify(r[l],t),n=n&&-1===o[i].done,o[i]instanceof V)return V.make(t,"&reduce["+o[i].canon+","+r[l].canon+"]",o[i],r[l]);return(s=0===o.length?T:1===o.length?o[0]:new L(o)).done=n?-1:this.done+1,s}get canon(){return this.peg.map(e=>e.canon).join("&")}gen(e){if(0<this.peg.length){let t=this.peg[0],n=void 0;return void 0===t||t instanceof V?e.push("nil:|:none="+this.canon):n=t.gen(e),n}e.push("nil:|:empty="+this.canon)}}S.ConjunctVal=L;class M extends _{constructor(e){super(e)}append(e){return this.peg.push(e),this}unify(e,t){let n,r=!0,s=[];for(let o=0;o<this.peg.length;o++)s[o]=this.peg[o].unify(e,t),r=r&&-1===s[o].done;if(1<s.length){for(let t=0;t<s.length;t++)s[t]instanceof M&&s.splice(t,1,...s[t].peg);let e=V.make(t,"remove");for(let t=0;t<s.length;t++)for(let n=t+1;n<s.length;n++)s[n].same(s[t])&&(s[n]=e);s=s.filter(e=>!(e instanceof V))}if(1==s.length)n=s[0];else{if(0==s.length)return V.make(t,"|:empty",this);n=new M(s)}return n.done=r?-1:this.done+1,n}get canon(){return this.peg.map(e=>e.canon).join("|")}gen(e){if(0<this.peg.length){let t=this.peg.filter(e=>e instanceof B),n=(t=0===t.length?this.peg:t)[0];for(let e=1;e<this.peg.length;e++)n=n.unify(this.peg[e]);return n.gen(e)}e.push("nil:|:empty="+this.canon)}}S.DisjunctVal=M;class D extends _{constructor(e){super(e),this.parts=e.split("/").filter(e=>""!=e),this.absolute=e.startsWith("/")}append(e){this.parts.push(e),this.peg=(this.absolute?"/":"")+this.parts.join("/")}unify(e,t){let n,r=null==t?this:t.find(this)||this;return(n=r instanceof D?T===e?new D(this.peg):e instanceof V?V.make(t,"ref["+this.peg+"]",this,e):new L([this,e]):r.unify(e,t)).done=-1===n.done?-1:this.done+1,n}get canon(){return this.peg}gen(e){e.push(this.canon)}}S.RefVal=D;class B extends _{constructor(e,t){super(e),this.pref=t||e}unify(e,t){let n,r=!0;return n=e instanceof B?new B(this.peg.unify(e.peg,t),this.pref.unify(e.pref,t)):new B(this.peg.unify(e,t),this.pref.unify(e,t)),r=r&&-1===n.peg.done&&(null==n.pref||-1===n.pref.done),n.peg instanceof V?n=n.pref:n.pref instanceof V&&(n=n.peg),n.done=r?-1:this.done+1,n}get canon(){return this.pref instanceof V?this.peg.canon:"*"+this.pref.canon}gen(e){e.push(this.canon);let t=this.pref instanceof V?this.peg instanceof V?void 0:this.peg:this.pref;return void 0===t?void 0:t.gen(e)}}S.PrefVal=B;var F={};Object.defineProperty(F,"__esModule",{value:!0}),F.Lang=void 0;let U=function(t){t.options({value:{src:{string:()=>new S.ScalarTypeVal(String),number:()=>new S.ScalarTypeVal(Number),integer:()=>new S.ScalarTypeVal(S.Integer),boolean:()=>new S.ScalarTypeVal(Boolean),nil:()=>new S.Nil([],"literal"),top:()=>S.TOP}},token:{"#A&":{c:"&"},"#A|":{c:"|"},"#A/":{c:"/"},"#A*":{c:"*"},"#A=":{c:"="}},map:{merge:(e,t)=>{let n=e,r=t;return new S.ConjunctVal([n,r])}}});let n=t.token.NR,r=t.token.TX,s=t.token.ST,o=t.token.VL,i=t.token.OB,l=t.token.OS,a=t.token["#A&"],c=t.token["#A|"],u=t.token["#A/"],p=t.token["#A*"],f=t.token["#A="];t.rule("expr",()=>new e.RuleSpec({open:[{s:[[a,c,p]],p:"disjunct",b:1,n:{expr:1}}],close:[{s:[]}],bo:e=>e.node={t:e.node},ac:e=>{let t=e.child.node.o;if(t instanceof S.PrefVal)return{err:"single-pref"};e.node=t}})),t.rule("disjunct",()=>new e.RuleSpec({open:[{s:[a],p:"conjunct",b:1},{s:[p],p:"pref",b:1},{s:[c,p],p:"pref",b:1,a:e=>{e.node.o=e.node.o instanceof S.DisjunctVal?e.node.o:new S.DisjunctVal([e.node.t])}},{s:[c,[n,r,s,o,i,l]],b:1,p:"val",a:e=>{e.node.o=e.node.o instanceof S.DisjunctVal?e.node.o:new S.DisjunctVal([e.node.t])}}],close:[{s:[c],r:"disjunct",b:1,a:e=>{var t;let n=(null===(t=e.child.node)||void 0===t?void 0:t.o)||e.child.node;e.node.t=n}},{s:[a],r:"disjunct",b:1,a:e=>{var t;let n=(null===(t=e.child.node)||void 0===t?void 0:t.o)||e.child.node;e.node.t=n,e.child.node=null}},{}],ac:e=>{var t;let n=(null===(t=e.child.node)||void 0===t?void 0:t.o)||e.child.node;n&&(e.node.o instanceof S.DisjunctVal?e.node.o.append(n):e.node.o=n)}})),t.rule("conjunct",()=>new e.RuleSpec({open:[{s:[a,[n,r,s,o,i,l,u]],b:1,p:"val",a:e=>{e.node={o:e.node.o instanceof S.ConjunctVal?e.node.o:new S.ConjunctVal([e.node.t])}}}],close:[{s:[a],r:"conjunct",b:1},{}],ac:e=>{var t;let n=(null===(t=e.child.node)||void 0===t?void 0:t.o)||e.child.node;n&&(e.node.o instanceof S.ConjunctVal?e.node.o.append(n):e.node.o=n)}})),t.rule("path",()=>new e.RuleSpec({open:[{s:[u,[r,s,n,o]],p:"part",b:2}],bo:e=>e.node=new S.RefVal("/")})),t.rule("part",()=>new e.RuleSpec({open:[{s:[u,[r,s,n,o]],r:"part",a:e=>{e.node.append(e.open[1].src)}},{}]})),t.rule("pair",e=>{e.def.open.unshift({s:[[a,c],f],p:"val",u:{spread:!0}});let t=e.def.bc;return e.def.bc=function(e,n){let r=t.call(this,e,n);return e.use.spread&&(e.node[S.MapVal.SPREAD]={o:e.open[0].src,v:e.child.node}),r},e}),t.rule("pref",()=>new e.RuleSpec({open:[{s:[p,[n,r,s,o,i,l,u]],b:1,p:"val"}],close:[{s:[a],e:e=>e.open[1]},{}],ac:e=>{e.node=new S.PrefVal(e.child.node)}})),t.rule("val",e=>{e.def.open.unshift({s:[p,[n,r,s,o,i,l,u]],p:"expr",b:2},{s:[u,[r,s,n,o]],p:"path",b:2}),e.def.close.unshift({s:[[a,c]],p:"expr",b:1,c:e=>null==e.n.expr||0===e.n.expr});let t=e.def.bc;return e.def.bc=function(e,n){let r=t.call(this,e,n),s=e.node,o=typeof s;"string"===o?s=new S.StringVal(e.node):"number"===o?s=Number.isInteger(e.node)?new S.IntegerVal(e.node):new S.NumberVal(e.node):"boolean"===o&&(s=new S.BooleanVal(e.node));let i=e.open[0];return s.row=i.row,s.col=i.col,s.url=n.meta.multisource&&n.meta.multisource.path,e.node=s,r},e}),t.rule("map",e=>{let t=e.def.bc;return e.def.bc=function(e,n){let r=t?t.call(this,e,n):void 0;return e.node=new S.MapVal(e.node),r},e})};F.Lang=class{constructor(t){this.options={src:"",print:-1},this.options=Object.assign({},this.options,t),this.jsonic=e.Jsonic.make().use(U).use(k.MultiSource,{resolver:t?t.resolver:void 0})}parse(e,t){let n={multisource:{path:this.options.base,deps:t&&t.deps||void 0}};return t&&null!=t.log&&Number.isInteger(t.log)&&(n.log=t.log),this.jsonic(e,n)}};var $={};Object.defineProperty($,"__esModule",{value:!0}),$.Unify=void 0;class J{constructor(e){this.root=e.root,this.path=[],this.err=e.err||[]}descend(e){let t={root:this.root,err:this.err},n=new J(t);return n.err=this.err,n.path=this.path.concat(e),n}find(e){if(this.root instanceof S.MapVal&&e.absolute){let t=this.root,n=0;for(;n<e.parts.length&&t instanceof S.MapVal;n++){let r=e.parts[n];t=t.peg[r]}if(n===e.parts.length)return t}}}$.Unify=class{constructor(e,t){this.dc=0,this.lang=t||new F.Lang,"string"==typeof e&&(e=this.lang.parse(e)),this.root=e,this.res=e,this.err=[];let n,r=e;for(;this.dc<111&&S.DONE!==r.done;)n=new J({root:r,err:this.err}),r=r.unify(S.TOP,n),this.dc++;this.res=r}};var Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.util=Z.Nil=Z.Val=Z.Aontu=void 0,Object.defineProperty(Z,"Val",{enumerable:!0,get:function(){return S.Val}}),Object.defineProperty(Z,"Nil",{enumerable:!0,get:function(){return S.Nil}});const W=()=>({path:"<no-path>",full:"<no-full>",base:"<no-base>"});function Y(e,t){let n=H.options(e,t),r={},s=new F.Lang(n).parse(n.src,{deps:r}),o=new $.Unify(s).res;return o.deps=r,o}Z.Aontu=Y;const H={options:(e,t)=>({src:"",print:0,resolver:W,..."string"==typeof e?{src:e}:e,...t||{}})};return Z.util=H,Z.default=Y,Z}));