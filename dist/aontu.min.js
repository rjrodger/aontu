!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Aontu=t()}}((function(){var t={};function e(t,e,s){let n=t;for(let r=0;r<e.length;r++)n=n[e[r]]=n[e[r]]||(r<e.length-1?{}:s.scalar)}Object.defineProperty(t,"__esModule",{value:!0}),t.parseVal=t.bottom=t.RefVal=t.IntScalarVal=t.IntTypeVal=t.BottomVal=t.Path=t.Node=t.reify=t.unify=void 0,t.unify=function(t){let e={s:Date.now(),d:0},r=t.map(t=>"string"==typeof t?function(t){let[e,n]=t.split(":");return new s(e,n)}(t):s.clone(t)).sort((t,e)=>{let s=t.path.parts.length-e.path.parts.length;return 0===s?t.path.parts_str<e.path.parts_str?-1:t.path.parts_str>e.path.parts_str?1:0:s});r=r.reduce((t,e,s,n)=>{let r=n[s-1];return r&&e.path.equals(r.path)?r.vals.splice(r.vals.length,0,...e.vals):t.push(e),t},[]);let a={path:new n([]),nodes:r},i=r.length;for(let s=0;s<r.length&&s<11*i;s++){let t=r[s];if(!t)break;void 0===t.unify(a)&&r.push(t)}return e.d=Date.now()-e.s,r.$meta=e,r.slice(0,i)},t.reify=function(t){let s={};for(let n=0;n<t.length;n++){let r=t[n];e(s,r.path.parts,r.val)}return s};class s{constructor(t,e){this.path=new n(t),this.vals="string"==typeof e?e.split(/\s*,\s*/).filter(t=>""!==t).map(t=>r(t)):e.map(t=>"string"==typeof t?r(t):t)}static clone(t){return new s(t.path,t.vals)}unify(t){if(this.val)return this.val;let e=Object.assign(Object.assign({},t),{path:this.path}),s=i;for(let n=0;n<this.vals.length&&(s=s.unify(this.vals[n],e));n++);return s&&(this.val=s),this.val}toString(){return this.path.parts_str+": "+this.val+" # "+this.vals}}t.Node=s;class n{constructor(t){this.parts=[],this.parts_str="",t=t instanceof n?t.parts:t,this.parts="string"==typeof t?t.split(/\./):[...t],this.parts_str=this.parts.join(".")}equals(t){return this.parts_str===t.parts_str}deeper(t){return this.parts.length>t.parts.length}}function r(t){let e=o;t=t.trim();let s=parseInt(t);return isNaN(s)?"int"===t?new h:t.startsWith("$")?new u(new n(t)):e:new p(s)}t.Path=n,t.parseVal=r;class a{unify(t,e){return t.unify(this,e)}toString(){return"top"}}const i=new a;class l{unify(){return this}toString(){return"bottom"}}t.BottomVal=l;const o=new l;t.bottom=o;class h{unify(t){let e=o;return t instanceof a?this:((t instanceof p||t instanceof h)&&(e=t),e)}toString(){return"int"}}t.IntTypeVal=h;class p{constructor(t){this.scalar=t}unify(t,e){let s=o;return t instanceof a?this:t instanceof p?t.scalar===this.scalar?t:o:t instanceof h?this:s}toString(){return"int="+this.scalar}}t.IntScalarVal=p;class u{constructor(t){this.val=void 0,this.path=t}unify(t,e){let s=void 0;return this.val=function(t,e){let s=e.find(e=>t.equals(e.path));return s?s.val:void 0}(this.path,e.nodes),this.val&&(s=this.val=this.val.unify(t,e)),s}toString(){return this.path.parts_str}}return t.RefVal=u,t}));